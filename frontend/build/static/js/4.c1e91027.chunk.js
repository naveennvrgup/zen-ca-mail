(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{407:function(e,t,a){"use strict";a.r(t);var n=a(7),s=a(2),r=a(6),l=a(4),i=a(3),o=a(5),c=a(0),d=a.n(c),m=a(133),u=a(13),f=function(e){function t(){var e,a;Object(s.a)(this,t);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return(a=Object(l.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(o)))).axios=Object(u.b)(),a.state={files:[]},a.componentDidMount=function(){var e=a.props.initialFiles;console.log(e),e=e.map(function(e){return{id:e.id,url:e.file,progess:"100%",name:e.file.split("/").pop(),saved:!0}}),a.setState(Object(n.a)({},a.state,{files:e}))},a.selectFilesHandler=function(e){e.preventDefault();var t=document.createElement("input");t.type="file",t.multiple=!0,t.click(),t.addEventListener("change",function(e){for(var s=Object(m.a)(a.state.files),r=function(e){var a=t.files[e],n=!0;s.forEach(function(e){e.name===a.name&&(n=!1)}),n&&s.push({file:a,name:a.name,progress:0})},l=0;l<t.files.length;l++)r(l);a.setState(Object(n.a)({},a.state,{files:s}))})},a.uploadFileHandler=function(e,t){e.preventDefault();var s=new FormData,r=new XMLHttpRequest;s.append("file",t.file),s.append("draft",a.props.draftId),r.addEventListener("load",function(e){var s=e.target.response;console.log(s),a.setState({files:a.state.files.map(function(e){return e.name===t.name?Object(n.a)({},e,{saved:!0,progress:"100%",url:s.file,id:s.id}):e})})}),console.log(a.state.files),r.upload.addEventListener("progress",function(e){var s=e.loaded/e.total*100+"%";a.setState({files:a.state.files.map(function(e){return e.name===t.name?Object(n.a)({},e,{progress:s}):e})})}),r.upload.addEventListener("abort",function(e){var s=a.state.files.filter(function(e){return e.name!==t.file.name});a.setState(Object(n.a)({},a.state,{files:s}))}),r.responseType="json",r.open("post",u.a+"api/attachment/"),r.setRequestHeader("Authorization",sessionStorage.token),r.send(s),a.setState({files:a.state.files.map(function(e){return e.name===t.name?Object(n.a)({},e,{request:r}):e})})},a.deleteFileHandler=function(e,t){e.preventDefault(),t.saved?a.axios.delete("api/attachment/".concat(t.id,"/")).then(function(e){e=e.data;var n=a.state.files.filter(function(e){return e.id!==t.id});a.setState({files:n})}):t.request.abort()},a}return Object(o.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this,t=d.a.createElement("div",{className:"alert alert-warning"},"No attachments yet");return this.state.files.length>0&&(t=[],this.state.files.forEach(function(a,n){var s=d.a.createElement("button",{className:"btn green nbtn mx-2",onClick:function(t){return e.uploadFileHandler(t,a)}},d.a.createElement("i",{className:"fa fa-upload"})),r="inprogess";a.progess||(r="waiting"),a.saved&&(r=d.a.createElement("a",{href:a.url,target:"_blank",rel:"noopener noreferrer"},"link")),(a.progress||a.id)&&(s=d.a.createElement("button",{className:"btn red nbtn mx-2",onClick:function(t){return e.deleteFileHandler(t,a)}},d.a.createElement("i",{className:"fa fa-times"}))),t.push(d.a.createElement("div",{className:"d-flex tab file align-items-center justify-content-between",key:a.name},d.a.createElement("div",{className:"d-flex align-items-center justify-content-between"},d.a.createElement("div",{className:"name mx-2"},a.name),d.a.createElement("div",{className:"link mx-2 badge badge-pill badge-dark"},r)),d.a.createElement("div",{className:"d-flex align-items-center justify-content-between"},d.a.createElement("div",{className:"progress mx-2 ".concat(a.saved?"hide-progress":"")},d.a.createElement("div",{className:"progress-bar progress-bar-striped m-0",style:{width:a.progress}})),s)))})),d.a.createElement("div",{className:"fileUpload"},d.a.createElement("div",{className:"d-flex align-items-center mt-3"},d.a.createElement("div",null,d.a.createElement("label",{className:"font-weight-bold mx-3 my-4"},"Attachments:")),d.a.createElement("div",null,d.a.createElement("button",{className:"btn blue nbtn",onClick:this.selectFilesHandler},d.a.createElement("i",{className:"fa fa-plus"})))),d.a.createElement("div",{className:"files"},t))}}]),t}(c.Component),p=a(237),b=a.n(p),h=(a(238),a(240),a(241),a(242),a(243),function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(r)))).onChange=function(e){console.log("onChange",e),a.props.onEditorStateChange(e)},a}return Object(o.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return d.a.createElement(b.a,{value:this.props.editorState,options:{lang:"en",height:350,dialogsInBody:!0,toolbar:[["style",["style"]],["font",["bold","underline","clear"]],["fontname",["fontname"]],["para",["ul","ol","paragraph"]],["table",["table"]],["insert",["link"]],["view",["fullscreen","codeview"]]]},onChange:this.onChange})}}]),t}(c.Component));a.d(t,"default",function(){return v});var v=function(e){function t(){var e,a;Object(s.a)(this,t);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return(a=Object(l.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(o)))).axios=Object(u.b)(),a.state={editorState:"<p>loading please wait...</p>"},a.componentDidMount=function(){a.subject=document.querySelector("#subject"),a.files=document.querySelector(".files"),a.draftId=a.props.match.params.id,localStorage.setItem("currDraft",a.draftId),a.axios.get("api/draft/"+a.draftId+"/").then(function(e){e=e.data,a.subject.value=e.subject,console.log(e),a.setState(Object(n.a)({},a.state,e,{editorState:e.body}))})},a.onEditorStateChange=function(e){a.setState({editorState:e})},a.saveDraftHandler=function(e,t){e.preventDefault(),a.axios.put("api/draft/"+a.draftId+"/",{subject:a.subject.value,body:a.state.editorState}).then(function(e){t?a.props.history.push("/admin/email/send_email/".concat(a.draftId,"/")):a.props.history.push("/admin/email/")})},a.deleteDraftHandler=function(e){e.preventDefault(),a.axios.delete("api/draft/"+a.draftId+"/").then(function(e){console.log(e.data),a.props.history.push("/admin/email/")})},a}return Object(o.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this;return d.a.createElement("div",{className:"newMail"},d.a.createElement("form",{className:""},d.a.createElement("div",{className:"d-md-flex d-block align-items-center justify-content-between"},d.a.createElement("h1",{className:"text-center"},"Edit Mail"),d.a.createElement("div",{className:"buttons py-md-3 py-1 ".concat(this.state.status?"d-none":"d-flex justify-content-center")},d.a.createElement("button",{className:"btn btn-outline-danger mr-3",onClick:this.deleteDraftHandler},"delete"),d.a.createElement("button",{className:"btn mr-3",onClick:function(t){return e.saveDraftHandler(t,!1)}},"save"),d.a.createElement("button",{className:"btn btn-success",onClick:function(t){return e.saveDraftHandler(t,!0)}},"send"))),d.a.createElement("div",{className:"form-group mt-3"},d.a.createElement("label",{htmlFor:"subject",className:"font-weight-bold"},"Subject:"),d.a.createElement("input",{status:this.state.status,type:"text",id:"subject",className:"form-control w-100"})),d.a.createElement("label",{className:"font-weight-bold mt-2"},"Body:"),d.a.createElement("div",{className:"body"},d.a.createElement(h,{onEditorStateChange:this.onEditorStateChange,editorState:this.state.editorState})),this.state.files?d.a.createElement(f,{draftId:this.draftId,initialFiles:this.state.files}):""))}}]),t}(c.Component)}}]);
//# sourceMappingURL=4.c1e91027.chunk.js.map