{"version":3,"sources":["admin/news/file_upload.js","admin/news/new_news.js"],"names":["FileUpload","axios","faxios","state","progress","onprogress","componentDidMount","_this","setState","Object","objectSpread","props","selectFilesHandler","e","preventDefault","fi","document","createElement","type","accept","click","addEventListener","file","target","files","uploadFileHandler","data","FormData","request","XMLHttpRequest","console","log","append","selected_group_id","res","response","upload","loaded","total","responseType","open","burl","concat","newsId","setRequestHeader","sessionStorage","send","abortUploadHandler","abort","delete_handler","patch","id","img","then","d","btn_text","this","react_default","a","className","btn_img_true","onClick","btn_img_false","button_to_show","progress_bar","style","width","filename","split","pop","href","rel","Component","NewMail","querySelector","title","link","brief","match","params","get","value","saveNewsHandler","show_news","put","show","history","push","showNewsHandler","_callee","regenerator_default","wrap","_context","prev","next","stop","deleteNewsHandler","flag","head","file_upload_FileUpload","assign","rows"],"mappings":"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","file":"static/js/1.87ff5393.chunk.js","sourcesContent":["import React, { Component } from 'react'\nimport faxios, { burl } from '../../axios'; \n\nexport default class FileUpload extends Component {\n    axios = faxios()\n    state = {\n        progress: 0,\n        onprogress: false,\n    }\n\n    componentDidMount = () => {\n        \n        this.setState({\n            ...this.state,\n            ...this.props\n        })// end of setstate\n    }\n\n\n    selectFilesHandler = e => {\n        e.preventDefault()\n\n        let fi = document.createElement('input')\n        fi.type = 'file'\n        fi.accept = \"image/x-png,image/gif,image/jpeg\"\n        fi.click()\n\n        fi.addEventListener('change', e => {\n            let file = e.target.files[0]\n            this.uploadFileHandler(file)\n        })\n    }\n\n    uploadFileHandler = (file) => {\n\n        var data = new FormData();\n        var request = new XMLHttpRequest();\n        console.log(this.props)\n        data.append('group_id', this.props.selected_group_id)\n        data.append('img', file);\n\n        // load event\n        request.addEventListener('load', (e) => {\n            let res = e.target.response\n            console.log(res);\n\n            this.setState({\n                ...this.state,\n                ...res,\n                onprogress: false\n            })\n        });\n\n        // monitor progress of upload\n        request.upload.addEventListener('progress', (e) => {\n            var progress = (e.loaded / e.total) * 100 + \"%\"\n            console.log(progress)\n            this.setState({\n                ...this.state,\n                progress\n            })\n        })\n\n        request.upload.addEventListener('abort', e => {\n            this.setState({\n                ...this.state,\n                onprogress: false,\n                progress: 0\n            })// end of setstate\n        })\n\n        \n        request.responseType = 'json';\n        request.open('patch', burl + `api/news/${this.props.newsId}/`);\n        request.setRequestHeader('Authorization',sessionStorage['token'])\n        request.send(data);\n\n        this.setState({\n            ...this.state,\n            progress: 0,\n            onprogress: true,\n            request\n        })// end of setstate\n    }\n\n    abortUploadHandler = (e) => {\n        e.preventDefault()\n        this.state.request.abort()\n    }\n\n    delete_handler = e => {\n        e.preventDefault()\n        this.axios.patch(`api/news/${this.state.id}/`, {\n            img: null\n        }).then(d => {\n            console.log(d.data)\n            this.setState({\n                ...this.state,\n                ...d.data,\n                progress: 0\n            })// end of setstate\n            console.log(this.state)\n        })\n    }\n\n    render() {\n        let btn_text = this.state.onprogress ?\n            <i className=\"fa fa-times\"></i> :\n            <i className=\"fa fa-upload\"></i>\n\n        let btn_img_true =\n            <button\n                onClick={this.delete_handler}\n                className=\"btn btn-primary\">\n                <i className=\"fa fa-times\"></i>\n            </button>\n\n        let btn_img_false =\n            <button\n                onClick={this.state.onprogress ? this.abortUploadHandler : this.selectFilesHandler}\n                className=\"btn btn-primary\">\n                {btn_text}\n            </button>\n\n        let button_to_show = this.state.img ? btn_img_true : btn_img_false\n\n\n        let progress_bar =\n            <div className={`progress mx-2 ${this.state.onprogress ? '' : 'hide-progress'}`}>\n                <div className=\"progress-bar progress-bar-striped\" style={{ width: this.state.progress }}></div>\n            </div>\n\n        let filename = this.state.img && this.state.img.split('/').pop()\n\n        return (\n            <div className='flex-grow-1 px-0'>\n                <div className=\"new_sub_csv d-flex justify-content-between align-items-center\">\n                    <div className=''>\n                        <span>\n                            {filename ? filename : 'No images attached to the news'}\n                        </span>\n                        {this.state.img && <span className=\"badge text-white mx-2 badge-dark badge-pill\">\n                            <a href={this.state.img} rel=\"noopener noreferrer\" target='_blank'>\n                                link\n                            </a>\n                        </span>}\n\n                    </div>\n                    <div className='d-flex justify-content-between align-items-center'>\n                        {progress_bar}\n                        {button_to_show}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n","import React, { Component } from 'react'\nimport FileUpload from './file_upload'\nimport faxios from '../../axios'; \n\n\nexport default class NewMail extends Component {\n    axios = faxios()\n    state = {\n\n    }\n\n    componentDidMount = () => {\n        \n        this.files = document.querySelector('.edit_news');\n        this.title = this.files.querySelector('.title')\n        this.link = this.files.querySelector('.link')\n        this.brief = this.files.querySelector('.brief')\n\n        this.newsId = this.props.match.params.id\n\n        this.axios.get('api/news/' + this.newsId + '/')\n            .then(d => {\n                d = d.data\n                console.log(d)\n                this.title.value = d.title\n                this.link.value = d.link\n                this.brief.value = d.brief\n                this.setState({\n                    ...this.state,\n                    ...d\n                })\n            })\n    }\n\n    saveNewsHandler = (e, show_news) => {\n        e.preventDefault()\n\n        this.axios.put('api/news/' + this.state.id + '/', {\n            title: this.title.value,\n            link: this.link.value,\n            brief: this.brief.value,\n            show: show_news ? show_news : this.state.show\n        })\n            .then(d => {\n                console.log(d.data)\n                this.props.history.push('/admin/news/')\n            })\n    }\n\n    showNewsHandler = async (e) => {\n        e.preventDefault()\n        await this.saveNewsHandler(e, true)\n        this.props.history.push(`/admin/news/`)\n    }\n\n    deleteNewsHandler = (e) => {\n        e.preventDefault()\n        this.axios.patch('api/news/' + this.newsId + '/',{\n            flag: true\n        })\n            .then(d => {\n                console.log(d.data)\n                this.props.history.push('/admin/news/')\n            })\n    }\n\n    render() {\n        let head = <h1>Edit News</h1>\n\n        return (\n            <div className='edit_news p-5'>\n                <form className='ml-3'>\n                    <div className=\"d-flex align-items-center justify-content-between\">\n                        {head}\n                        <div className={`buttons py-3 d-flex`}>\n                            <button className=\"btn btn-outline-danger mr-3\"\n                                onClick={this.deleteNewsHandler}>delete</button>\n                            <button className=\"btn mr-3\"\n                                onClick={this.saveNewsHandler}>save</button>\n                            <button className=\"btn btn-success\"\n                                onClick={this.showNewsHandler}>show</button>\n                        </div>\n                    </div>\n\n                    {/* title */}\n                    <div className=\"form-group mt-3\">\n                        <label className='font-weight-bold'>Title:</label>\n                        <input\n                            type='text'\n                            className='title form-control w-100' />\n                    </div>\n\n                    {/* img */}\n                    <div className=\"form-group mt-3\">\n                        <label className='font-weight-bold'>Img:</label>\n                        <div className=\"form-control d-flex pr-0 align-items-center\">\n                            {this.state.id && <FileUpload\n                                {...this.state}\n                                newsId={this.state.id} />}\n                        </div>\n                    </div>\n\n                    {/* link */}\n                    <div className=\"form-group mt-3\">\n                        <label className='font-weight-bold'>Link:</label>\n                        <input\n                            type='text'\n                            className='link form-control w-100' />\n                    </div>\n\n                    {/* brief */}\n                    <div className=\"form-group mt-3\">\n                        <label className='font-weight-bold'>Brief:</label>\n                        <textarea\n                            rows='4'\n                            className='brief form-control w-100' />\n                    </div>\n\n                    {/* {this.state.files ?\n                        <FileUpload NewsId={this.NewsId} initialFiles={this.state.files} />\n                        : ''} */}\n\n                </form>\n            </div>\n        )\n    }\n}\n"],"sourceRoot":""}